{
  "name": "智能排课 API 文档",
  "description": "API 前缀为 `/pk/znpk`",
  "metadata": {
    "FORMAT": "1A",
    "BASE_URI": "/pk/znpk"
  },
  "resourceGroups": [
    {
      "element": "category",
      "name": "接口约定",
      "description": ":::note\n\n- 定义如下基础参数，并在每个请求 (GET, POST, PUT, DELETE) 地址中带上：\n\n  - `schemeId`： 排课方案Id\n  - `gradeId`： 年级Id\n  - `campus`： 校区Id\n:::",
      "resources": []
    },
    {
      "element": "resource",
      "name": "通用接口",
      "description": "",
      "resources": [
        {
          "name": "获取班级列表",
          "description": "",
          "parameters": [],
          "uriTemplate": "/classes.do",
          "method": "GET",
          "methodLower": "get",
          "request": {
            "hasContent": false,
            "data": null,
            "body": null
          },
          "response": {
            "hasContent": true,
            "status": "200",
            "data": null,
            "body": "{\n      success: true,\n      message: '处理成功！',\n      data: [\n        {\n          classId: 'classId001',\n          className: '1班',\n          isLocked: true  // 班级是否锁定\n        }\n      ]\n    }"
          }
        },
        {
          "name": "获取排课节次",
          "description": "",
          "parameters": [
            {
              "name": "classId",
              "description": "班级id",
              "type": "string",
              "required": "required",
              "enums": false,
              "example": "class01"
            }
          ],
          "uriTemplate": "/lesson_times.do{?classId}",
          "method": "GET",
          "methodLower": "get",
          "request": {
            "hasContent": false,
            "data": null,
            "body": null
          },
          "response": {
            "hasContent": true,
            "status": "200",
            "data": {
              "success": true,
              "message": "处理消息",
              "data": null
            },
            "body": "{\n  \"success\": true,\n  \"message\": \"处理消息\",\n  \"data\": {\n    \"days\": 5,\n    \"dayLessons\": 10\n  }\n}"
          }
        }
      ]
    },
    {
      "element": "resource",
      "name": "班级课表",
      "description": "",
      "resources": [
        {
          "name": "获取待安排全部课程",
          "description": "",
          "parameters": [
            {
              "name": "classId",
              "description": "班级id",
              "type": "string",
              "required": "required",
              "enums": false,
              "example": "class01"
            }
          ],
          "uriTemplate": "/unarranged.do{?classId}",
          "method": "GET",
          "methodLower": "get",
          "request": {
            "hasContent": false,
            "data": null,
            "body": null
          },
          "response": {
            "hasContent": true,
            "status": "200",
            "data": null,
            "body": "{\n      success: true,\n      message: '处理成功！',\n      data: [\n        {\n          id: 'id001',\n          courseId: 'courseid001',\n          courseName: '语文',\n          teacherId: 'teacher01',\n          teacherName: '张三',\n          remainLessons: 2,   // 可安排课时\n          totalLessons: 2,   // 总共课时\n          isSpecialRoom: 0,  // 0:普通， 1:特殊，2：仅单周特殊，3：仅双周特殊，5：单双周都特殊\n          roomName: null,\n          roomId: null\n        }\n      ]\n    }"
          }
        },
        {
          "name": "获取某一班级的课表安排",
          "description": "`isSpecialRoom`: `0`:普通， `1`:特殊，`2`：仅单周特殊，`3`：仅双周特殊，`5`：单双周都特殊",
          "parameters": [
            {
              "name": "classId",
              "description": "班级id",
              "type": "string",
              "required": "required",
              "enums": false,
              "example": "class01"
            }
          ],
          "uriTemplate": "/class_schedule.do{?classId}",
          "method": "GET",
          "methodLower": "get",
          "request": {
            "hasContent": false,
            "data": null,
            "body": null
          },
          "response": {
            "hasContent": true,
            "status": "200",
            "data": null,
            "body": "{\n      success: true,\n      message: '处理成功！',\n      data: {\n        '1,4': {\n          xzb: [\n            {\n              id: 'id001',\n              courseId: 'courseid001',\n              courseName: '物理',\n              teacherId: 'teacherid001',\n              teacherName: '张三',\n              isLocked: false,\n              isSpecialRoom: 0, // 0:普通， 1:特殊，2：仅单周特殊，3：仅双周特殊，5：单双周都特殊\n              roomName: '特殊教室',  // 特殊教室单独安排\n              roomId: 'roomid001'\n            }\n          ],\n          fcb: [\n            {\n              id: 'id001',\n              teacherId: 'teacherid001',\n              teacherName: '张安',\n              courseId: 'courseid01',\n              courseName: '物理',\n              levelId: 'levelid01',\n              levelName: '中考层',\n              classId: 'classid001',\n              className: '分层班1班',\n              isLocked: false\n            }  \n          ],\n          fixed: ['全局固定点']\n        }\n      }\n    }"
          }
        },
        {
          "name": "拖拽时获取教师已有课表",
          "description": "",
          "parameters": [
            {
              "name": "teacherId",
              "description": "教师id,如: `teacherid01,teacherid02`",
              "type": "string",
              "required": "required",
              "enums": false,
              "example": "teacherid001"
            }
          ],
          "uriTemplate": "/teacher_schedule.do{?teacherId}",
          "method": "GET",
          "methodLower": "get",
          "request": {
            "hasContent": false,
            "data": null,
            "body": null
          },
          "response": {
            "hasContent": true,
            "status": "200",
            "data": null,
            "body": "{\n      success: true,\n      message: '处理成功！',\n      data: {\n        '1,2': {\n          type: 'xzb',\n          courseId: 'courseid001',\n          courseName: '物理',\n          teacherId: 'teacherid001',\n          teacherName: '张三',\n          classId: 'classid01',\n          className: '1班',\n          gradeId: 'gradeid001',\n          gradeName: '二年级',\n          campus: '本'\n        },\n        '1,3': {\n          type: 'fcb'\n        },\n        '2,3': {\n          type: 'noclass', // 教师不排课\n          desc: '语文教研'\n        }\n      }\n    }"
          }
        },
        {
          "name": "拖拽时获取排课点位",
          "description": "`noclass`: 教师不排课; `unavail`: 不排课点位\n\n注意：如果`classType`为`fcb`，则`id`包含多个id，由逗号连接，形如：`id001,id002,id003`",
          "parameters": [
            {
              "name": "id",
              "description": "id",
              "type": "string",
              "required": "required",
              "enums": false,
              "example": "id001"
            },
            {
              "name": "lessonFlag",
              "description": "当前节次",
              "type": "string",
              "required": "required",
              "enums": false,
              "example": "1,2"
            },
            {
              "name": "courseId",
              "description": "课程id",
              "type": "string",
              "required": "required",
              "enums": false,
              "example": "courseid001"
            },
            {
              "name": "classId",
              "description": "班级id",
              "type": "string",
              "required": "required",
              "enums": false,
              "example": "classid001"
            },
            {
              "name": "classType",
              "description": "拖拽的班级类型",
              "type": "enum",
              "required": "required",
              "enums": [
                "xzb",
                "fcb"
              ],
              "example": "xzb"
            }
          ],
          "uriTemplate": "/avail.do{?id,lessonFlag,courseId,classType,classId}",
          "method": "GET",
          "methodLower": "get",
          "request": {
            "hasContent": false,
            "data": null,
            "body": null
          },
          "response": {
            "hasContent": true,
            "status": "200",
            "data": null,
            "body": "{\n      \"success\": true,\n      \"message\": \"响应消息\",\n      \"data\": {\n        '3,2': {\n          desc: '全局固定点',\n          type: 'fixed' // 点位不可排课，有提示信息\n        },\n        '1,2': {\n          desc: '教师不排课',\n          type: 'noclass' // 点位可排课，提示不排课原因\n        },\n        '3,4': {\n          type: 'unavail' // 点位不可排课，无提示信息\n        }\n      }\n    }"
          }
        },
        {
          "name": "拖拽后保存课表",
          "description": "",
          "parameters": [],
          "uriTemplate": "/save.do",
          "method": "POST",
          "methodLower": "post",
          "request": {
            "hasContent": true,
            "data": {
              "id": "id001",
              "oldFlag": "1,2",
              "newFlag": "1,2",
              "classType": "zxb",
              "classId": "classid001"
            },
            "body": "{\"id\":\"id001\",\"oldFlag\":\"1,2\",\"newFlag\":\"1,2\",\"classType\":\"zxb\",\"classId\":\"classid001\"}"
          },
          "response": {
            "hasContent": true,
            "status": "200",
            "data": {
              "success": true,
              "message": "处理成功"
            },
            "body": "{\n  \"success\": true,\n  \"message\": \"处理成功\"\n}"
          }
        },
        {
          "name": "删除课程",
          "description": "",
          "parameters": [
            {
              "name": "id",
              "description": "id",
              "type": "string",
              "required": "required",
              "enums": false,
              "example": "id001"
            },
            {
              "name": "lessonFlag",
              "description": "节次",
              "type": "string",
              "required": "required",
              "enums": false,
              "example": "1,3"
            }
          ],
          "uriTemplate": "/course/delele.do{?id,lessonFlag}",
          "method": "GET",
          "methodLower": "get",
          "request": {
            "hasContent": false,
            "data": null,
            "body": null
          },
          "response": {
            "hasContent": true,
            "status": "200",
            "data": {
              "success": true,
              "message": "处理成功"
            },
            "body": "{\n  \"success\": true,\n  \"message\": \"处理成功\"\n}"
          }
        }
      ]
    },
    {
      "element": "resource",
      "name": "教室安排",
      "description": "",
      "resources": [
        {
          "name": "获取教室列表",
          "description": "",
          "parameters": [
            {
              "name": "classId",
              "description": "班级id",
              "type": "string",
              "required": "required",
              "enums": false,
              "example": "classid001"
            },
            {
              "name": "courseId",
              "description": "课程id",
              "type": "string",
              "required": "required",
              "enums": false,
              "example": "classid001"
            },
            {
              "name": "lessonFlag",
              "description": "节次",
              "type": "string",
              "required": "required",
              "enums": false,
              "example": "classid001"
            },
            {
              "name": "specialCode",
              "description": "特殊教室类型",
              "type": "number",
              "required": "required",
              "enums": false,
              "example": "1"
            }
          ],
          "uriTemplate": "/rooms.do{?classId,courseId,lessonFlag,specialCode}",
          "method": "GET",
          "methodLower": "get",
          "request": {
            "hasContent": false,
            "data": null,
            "body": null
          },
          "response": {
            "hasContent": true,
            "status": "200",
            "data": null,
            "body": "{\n      success: true,\n      message: '处理成功！',\n      data: {\n        courseid01: [\n          {\n            roomName: '教室',\n            roomId: 'room001'\n          }\n        ]\n      }\n    }"
          }
        },
        {
          "name": "保存教室安排",
          "description": "`specialCode`: `0`:普通， `1`:特殊，`2`：仅单周特殊，`3`：仅双周特殊，`5`：单双周都特殊",
          "parameters": [
            {
              "name": "id",
              "description": "id",
              "type": "string",
              "required": "required",
              "enums": false,
              "example": "id001"
            },
            {
              "name": "roomId",
              "description": "教室id，如: `roomid01,roomid02`",
              "type": "string",
              "required": "required",
              "enums": false,
              "example": "room001"
            },
            {
              "name": "specialCode",
              "description": "特殊教室类型",
              "type": "number",
              "required": "required",
              "enums": false,
              "example": "1"
            }
          ],
          "uriTemplate": "/room/save.do{?id,roomId,specialCode}",
          "method": "POST",
          "methodLower": "post",
          "request": {
            "hasContent": false,
            "data": null,
            "body": null
          },
          "response": {
            "hasContent": true,
            "status": "200",
            "data": {
              "success": true,
              "message": "处理成功"
            },
            "body": "{\n  \"success\": true,\n  \"message\": \"处理成功\"\n}"
          }
        }
      ]
    },
    {
      "element": "resource",
      "name": "顶部操作栏",
      "description": "",
      "resources": [
        {
          "name": "获取冲突信息",
          "description": "提供冲突信息展示和生成周课表按钮（忽略冲突，强制生成）。",
          "parameters": [],
          "uriTemplate": "/conflict.do",
          "method": "GET",
          "methodLower": "get",
          "request": {
            "hasContent": false,
            "data": null,
            "body": null
          },
          "response": {
            "hasContent": true,
            "status": "200",
            "data": null,
            "body": "{\n      \"success\": true,\n        \"message\": \"排课冲突检测完成！\",\n      \"data\": {\n        \"students\": [\n          \"同一时间同一学生，不止在一个班级上课\"\n            ],\n        \"classRooms\": [\n                \"同一时间同一教室，有不止一个班级在上课\"\n            ],\n        \"teachers\": [\n                \"同一时间同一教师，不止在一个班级有课\"\n            ],\n        \"courses\": [\n          \"同一个班级的同一个科目既有分层课又有行政课\"\n        ],\n        \"disableTeachers\": [\n                \"教师帐号已锁定、教师已删除或者教师已离校\"\n            ]\n      }\n    }"
          }
        },
        {
          "name": "锁定课程",
          "description": "",
          "parameters": [
            {
              "name": "gradeId",
              "description": "年级id",
              "type": "string",
              "required": "required",
              "enums": false,
              "example": "gradeid001"
            },
            {
              "name": "classId",
              "description": "班级id",
              "type": "string",
              "required": "required",
              "enums": false,
              "example": "classid001"
            },
            {
              "name": "classType",
              "description": "班级类型",
              "type": "string",
              "required": "required",
              "enums": false,
              "example": "xzb"
            },
            {
              "name": "isLocked",
              "description": "是否锁定",
              "type": "boolean",
              "required": "required",
              "enums": false,
              "example": "true"
            },
            {
              "name": "id",
              "description": "课程id",
              "type": "string",
              "required": "required",
              "enums": false,
              "example": "courseid0001"
            },
            {
              "name": "lessonFlag",
              "description": "节次",
              "type": "string",
              "required": "required",
              "enums": false,
              "example": "1,2"
            }
          ],
          "uriTemplate": "/courses/lock.do{?isLocked,gradeId,classId}",
          "method": "POST",
          "methodLower": "post",
          "request": {
            "hasContent": false,
            "data": null,
            "body": null
          },
          "response": {
            "hasContent": true,
            "status": "200",
            "data": {
              "success": true,
              "message": "处理成功"
            },
            "body": "{\n  \"success\": true,\n  \"message\": \"处理成功\"\n}"
          }
        },
        {
          "name": "生成周课表",
          "description": "需检测冲突信息，无冲突后方可生成周课表。",
          "parameters": [],
          "uriTemplate": "/weekly_schedule.do",
          "method": "POST",
          "methodLower": "post",
          "request": {
            "hasContent": false,
            "data": null,
            "body": null
          },
          "response": {
            "hasContent": true,
            "status": "200",
            "data": {
              "success": true,
              "message": "处理成功"
            },
            "body": "{\n  \"success\": true,\n  \"message\": \"处理成功\"\n}"
          }
        },
        {
          "name": "清空排课结果",
          "description": "",
          "parameters": [],
          "uriTemplate": "/schedule/clear.do",
          "method": "GET",
          "methodLower": "get",
          "request": {
            "hasContent": false,
            "data": null,
            "body": null
          },
          "response": {
            "hasContent": true,
            "status": "200",
            "data": {
              "success": true,
              "message": "处理成功"
            },
            "body": "{\n  \"success\": true,\n  \"message\": \"处理成功\"\n}"
          }
        },
        {
          "name": "获取规则满足率",
          "description": "",
          "parameters": [],
          "uriTemplate": "/arrangeRate/ruleSatisfaction.do",
          "method": "GET",
          "methodLower": "get",
          "request": {
            "hasContent": false,
            "data": null,
            "body": null
          },
          "response": {
            "hasContent": true,
            "status": "200",
            "data": null,
            "body": "{\n        \"data\": {\n            \"allRate\": \"99.92%\",  // 总的规则满足率\n            \"fullRateList\": [ // 规则满足率100%\n                \"教师冲突\",\n                \"行政班课程冲突\",\n                \"全局固定点\",\n                \"老师课时限制\",\n                \"教师互斥\",\n                \"教师跨校区\",\n                \"主科65%在上午\",\n                \"课程优先区域\",\n                \"主科老师教案一致\",\n                \"副科老师教案一致\",\n                \"上午首节为主科\"\n            ],\n            \"advancedUnfullRateList\": [\"ICSTeacherAmOrPmClassesMinor\"], // 高级规则设置\n            \"advancedUnfullRateMap\": { // 高级规则满足率\n                \"ICSTeacherAmOrPmClassesMinor\": \"76.47%\"\n            },\n            \"unfullRateList\": [ // 未达到100%规则\n                \"ICSTeacherAvgAmFstPmLast\",\n                \"ICSTeacherAvgAmFstAmLast\",\n                \"ICSTeacherNoCrossAmPm\"\n            ],\n            \"unfullIdNameMap\": { // 未达到100%规则名称\n                \"ICSTeacherAmOrPmClassesMinor\": \"副科老师尽量在一上午/一下午集中上完\",\n                \"ICSTeacherAvgAmFstPmLast\": \"不能让老师在上午首节和下午末节连上\",\n                \"ICSTeacherAvgAmFstAmLast\": \"不能让老师在上午首节和上午末节连上\",\n                \"ICSTeacherNoCrossAmPm\": \"教师不跨上下午授课\"\n            },\n            \"messageMap\": { // 未达到100%规则详情\n                \"ICSTeacherAvgAmFstPmLast\": [\n                    \"邓凤教师在周3上午第一节和下午最后一节上课连上！\\r\\n\",\n                    \"杨照宇教师在周4上午第一节和下午最后一节上课连上！\\r\\n\"\n                ],\n                \"ICSTeacherAmOrPmClassesMinor\": [\n                    \"高中1年级zdy326班语文教师黄天英在周5跨上下午上课，没有集中上完！\\r\\n\",\n                    \"高中1年级zdy9班美术教师六社在周1跨上下午上课，没有集中上完！\\r\\n\"\n                ],\n                \"ICSTeacherAvgAmFstAmLast\": [\n                    \"邓凤教师在周3上午第一节和上午最后一节同时上课！\\r\\n\",\n                    \"王丹丹教师在周2上午第一节和上午最后一节同时上课！\\r\\n\"\n                ],\n                \"ICSTeacherNoCrossAmPm\": [\n                    \"高中1年级zdy326班语文教师黄天英在周5跨上下午上课，没有集中上完！\\r\\n\",\n                    \"高中1年级zdy3班数学教师菲菲在周1跨上下午上课，没有集中上完！\\r\\n\"\n                ]\n            },\n            \"unfullRateMap\": { // 未达到100%规则满足率\n                \"ICSTeacherAvgAmFstPmLast\": \"96.08%\",\n                \"ICSTeacherAvgAmFstAmLast\": \"92.16%\",\n                \"ICSTeacherNoCrossAmPm\": \"76.47%\"\n            }\n        },\n        \"error\": \"0\",\n        \"message\": \"查询规则满足率结束！\",\n        \"success\": true\n    }"
          }
        }
      ]
    },
    {
      "element": "resource",
      "name": "重新排课",
      "description": "",
      "resources": [
        {
          "name": "获取排课引擎地址等信息",
          "description": "",
          "parameters": [],
          "uriTemplate": "/engine/info.do",
          "method": "GET",
          "methodLower": "get",
          "request": {
            "hasContent": false,
            "data": null,
            "body": null
          },
          "response": {
            "hasContent": true,
            "status": "200",
            "data": {
              "success": true,
              "message": "处理成功",
              "data": null
            },
            "body": "{\n  \"success\": true,\n  \"message\": \"处理成功\",\n  \"data\": {\n    \"url\": \"socket_url\",\n    \"id\": \"userid001\",\n    \"time\": \"1534124236799\",\n    \"sign\": \"MD5_VALUE\",\n    \"flag\": \"北京一中【排课管理员】\",\n    \"schoolId\": \"schoolid001\",\n    \"pkSchoolId\": \"pkschoolid001\",\n    \"version\": \"8.2.0\"\n  }\n}"
          }
        },
        {
          "name": "检测排课数据冲突",
          "description": "",
          "parameters": [],
          "uriTemplate": "/arrange/validate.do",
          "method": "POST",
          "methodLower": "post",
          "request": {
            "hasContent": false,
            "data": null,
            "body": null
          },
          "response": {
            "hasContent": true,
            "status": "200",
            "data": {
              "success": true,
              "message": "处理成功"
            },
            "body": "{\n  \"success\": true,\n  \"message\": \"处理成功\"\n}"
          }
        },
        {
          "name": "提交排课结果",
          "description": "将排课结果转发给后台。后台保存排课结果后，前台刷新页面展示。",
          "parameters": [],
          "uriTemplate": "/arrange/result.do",
          "method": "POST",
          "methodLower": "post",
          "request": {
            "hasContent": false,
            "data": null,
            "body": null
          },
          "response": {
            "hasContent": true,
            "status": "200",
            "data": {
              "success": true,
              "message": "处理成功"
            },
            "body": "{\n  \"success\": true,\n  \"message\": \"处理成功\"\n}"
          }
        }
      ]
    },
    {
      "element": "resource",
      "name": "辅助功能",
      "description": "",
      "resources": [
        {
          "name": "下载排课数据和排课结果",
          "description": "`check`: true-锁定, false-所有",
          "parameters": [
            {
              "name": "check",
              "description": "是否锁定",
              "type": "Boolean",
              "required": "required",
              "enums": false,
              "example": "true"
            },
            {
              "name": "schemeId",
              "description": "schemeId",
              "type": "string",
              "required": "required",
              "enums": false,
              "example": "schemeid001"
            }
          ],
          "uriTemplate": "/help/download.do{?check,schemeId}",
          "method": "GET",
          "methodLower": "get",
          "request": {
            "hasContent": false,
            "data": null,
            "body": null
          },
          "response": {
            "hasContent": true,
            "status": "200",
            "data": {
              "success": true,
              "message": "处理成功"
            },
            "body": "{\n  \"success\": true,\n  \"message\": \"处理成功\"\n}"
          }
        },
        {
          "name": "导入排课结果_手动修改",
          "description": "",
          "parameters": [
            {
              "name": "schemeId",
              "description": "schemeId",
              "type": "string",
              "required": "required",
              "enums": false,
              "example": "schemeid001"
            }
          ],
          "uriTemplate": "/help/upload.do{?schemeId}",
          "method": "POST",
          "methodLower": "post",
          "request": {
            "hasContent": false,
            "data": null,
            "body": null
          },
          "response": {
            "hasContent": true,
            "status": "200",
            "data": {
              "success": true,
              "message": "处理成功"
            },
            "body": "{\n  \"success\": true,\n  \"message\": \"处理成功\"\n}"
          }
        }
      ]
    }
  ]
}